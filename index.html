<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <title>DJ MASTER PRO v8 - Drag & Drop Bulk</title>
    <style>
        :root { --neon: #00ffcc; --dark: #050505; --gray: #1a1a1a; --error: #ff4444; }
        body { background: var(--dark); color: var(--neon); font-family: 'Consolas', monospace; padding: 20px; text-align: center; }
        .master-panel { background: var(--gray); border: 2px solid var(--neon); max-width: 900px; margin: auto; padding: 30px; border-radius: 20px; box-shadow: 0 0 30px rgba(0,255,204,0.15); }
        
        /* Zona de Drag & Drop */
        #drop-zone { border: 3px dashed var(--neon); padding: 40px; border-radius: 15px; margin-bottom: 20px; cursor: pointer; transition: 0.3s; background: rgba(0, 255, 204, 0.05); }
        #drop-zone.hover { background: rgba(0, 255, 204, 0.2); border-style: solid; }
        #drop-zone p { font-size: 1.2rem; color: #fff; pointer-events: none; }

        .format-selector { margin: 20px 0; padding: 15px; background: #222; border-radius: 10px; }
        select { background: #000; color: var(--neon); border: 1px solid var(--neon); padding: 10px; border-radius: 5px; cursor: pointer; font-size: 1rem; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; background: #000; padding: 20px; border-radius: 10px; border: 1px solid #333; text-align: left; }
        .stat-item { font-size: 0.85rem; color: #fff; }
        .stat-item span { color: var(--neon); font-weight: bold; }
        
        canvas { width: 100%; height: 120px; background: #000; border-radius: 10px; margin: 10px 0; border: 1px solid #444; }
        
        .btn-master { background: var(--neon); color: black; border: none; padding: 20px 50px; font-weight: bold; font-size: 1.2rem; border-radius: 50px; cursor: pointer; text-transform: uppercase; transition: 0.3s; width: 100%; }
        .btn-master:hover { box-shadow: 0 0 25px var(--neon); transform: scale(1.02); }
        
        #file-list { margin-top: 15px; text-align: left; font-size: 0.8rem; color: #888; max-height: 100px; overflow-y: auto; padding: 10px; background: #000; border-radius: 5px; }
    </style>
</head>
<body>

<div class="master-panel">
    <h1>ðŸŽ§ DJ MASTER DRAG & DROP</h1>
    <p>Bulk Processing Mode - WAV / MP3 / FLAC</p>

    <div id="drop-zone">
        <p>TRAGE MELODIILE AICI SAU DÄ‚ CLICK</p>
        <input type="file" id="audioFiles" multiple accept="audio/*" style="display:none">
    </div>

    <div id="file-list">Niciun fiÈ™ier selectat.</div>

    <div class="format-selector">
        <label>FORMAT EXPORT: </label>
        <select id="exportFormat">
            <option value="wav">WAV (Lossless Pro)</option>
            <option value="mp3">MP3 (320kbps Quality)</option>
            <option value="flac">FLAC (Compressed Lossless)</option>
        </select>
    </div>

    <div class="stats-grid">
        <div class="stat-item">PROCESARE: <span id="currentFile">Inactiv</span></div>
        <div class="stat-item">ALGORITM: <span id="algoName">Studio Master v8</span></div>
        <div class="stat-item">BASS: <span id="bBoost">+6dB (Sub)</span></div>
        <div class="stat-item">LIMITER: <span id="lCap">-0.3dB</span></div>
    </div>

    <canvas id="waveCanvas"></canvas>
    
    <button id="processBtn" class="btn-master">START BULK MASTERING</button>
</div>

<script>
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('audioFiles');
    const fileListDisplay = document.getElementById('file-list');
    const processBtn = document.getElementById('processBtn');
    const canvas = document.getElementById('waveCanvas');
    const ctx = canvas.getContext('2d');

    let selectedFiles = [];

    // --- LOGICA DRAG & DROP ---
    dropZone.onclick = () => fileInput.click();

    dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('hover'); };
    dropZone.ondragleave = () => dropZone.classList.remove('hover');
    dropZone.ondrop = (e) => {
        e.preventDefault();
        dropZone.classList.remove('hover');
        handleFiles(e.dataTransfer.files);
    };

    fileInput.onchange = (e) => handleFiles(e.target.files);

    function handleFiles(files) {
        selectedFiles = Array.from(files);
        fileListDisplay.innerHTML = "<strong>FiÈ™iere pregÄƒtite:</strong><br>" + 
            selectedFiles.map(f => `â€¢ ${f.name}`).join('<br>');
    }

    // --- PROCESARE BULK ---
    processBtn.onclick = async () => {
        if (selectedFiles.length === 0) return alert("Trage niÈ™te melodii mai Ã®ntÃ¢i!");

        for (let file of selectedFiles) {
            document.getElementById('currentFile').innerText = file.name;
            await processAudio(file);
        }
        document.getElementById('currentFile').innerText = "FINALIZAT!";
    };

    async function processAudio(file) {
        const arrayBuffer = await file.arrayBuffer();
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const decodedData = await audioCtx.decodeAudioData(arrayBuffer);

        const offlineCtx = new OfflineAudioContext(
            decodedData.numberOfChannels,
            decodedData.length,
            decodedData.sampleRate
        );

        const source = offlineCtx.createBufferSource();
        source.buffer = decodedData;

        // --- ALGORITM MASTERING ---
        const bass = offlineCtx.createBiquadFilter();
        bass.type = "lowshelf";
        bass.frequency.value = 65;
        bass.gain.value = 6;

        const compressor = offlineCtx.createDynamicsCompressor();
        compressor.threshold.value = -20;
        compressor.ratio.value = 4;

        const limiter = offlineCtx.createDynamicsCompressor();
        limiter.threshold.value = -0.3;

        source.connect(bass);
        bass.connect(compressor);
        compressor.connect(limiter);
        limiter.connect(offlineCtx.destination);

        source.start(0);
        const renderedBuffer = await offlineCtx.startRendering();
        
        drawWaveform(renderedBuffer);

        const format = document.getElementById('exportFormat').value;
        const finalName = "MASTER_" + file.name.split('.').slice(0, -1).join('.') + "." + format;
        
        exportWav(renderedBuffer, finalName);
    }

    function drawWaveform(buffer) {
        const data = buffer.getChannelData(0);
        const step = Math.ceil(data.length / canvas.width);
        const amp = canvas.height / 2;
        ctx.fillStyle = "#000"; ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = "#00ffcc"; ctx.beginPath();
        for(let i=0; i < canvas.width; i++) {
            let min = 1.0, max = -1.0;
            for(let j=0; j<step; j++) {
                let datum = data[(i*step)+j];
                if (datum < min) min = datum;
                if (datum > max) max = datum;
            }
            ctx.lineTo(i, (1+min)*amp); ctx.lineTo(i, (1+max)*amp);
        }
        ctx.stroke();
    }

    function exportWav(buffer, filename) {
        const length = buffer.length * buffer.numberOfChannels * 2 + 44;
        const view = new DataView(new ArrayBuffer(length));
        const s = (o, str) => { for(let i=0; i<str.length; i++) view.setUint8(o+i, str.charCodeAt(i)); };
        s(0, 'RIFF'); view.setUint32(4, length-8, true); s(8, 'WAVE');
        s(12, 'fmt '); view.setUint32(16, 16, true); view.setUint16(20, 1, true);
        view.setUint16(22, buffer.numberOfChannels, true); view.setUint32(24, buffer.sampleRate, true);
        view.setUint32(28, buffer.sampleRate * buffer.numberOfChannels * 2, true);
        view.setUint16(32, buffer.numberOfChannels * 2, true); view.setUint16(34, 16, true);
        s(36, 'data'); view.setUint32(40, length-44, true);
        let offset = 44;
        for (let i = 0; i < buffer.length; i++) {
            for (let ch = 0; ch < buffer.numberOfChannels; ch++) {
                let sample = Math.max(-1, Math.min(1, buffer.getChannelData(ch)[i]));
                view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);
                offset += 2;
            }
        }
        const link = document.createElement('a');
        link.href = URL.createObjectURL(new Blob([view], {type:'audio/wav'}));
        link.download = filename;
        link.click();
    }
</script>
</body>
</html>
